<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>Even More Modifiers: Advanced content creation</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="icon.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Even More Modifiers
   &#160;<span id="projectnumber">0.1</span>
   </div>
   <div id="projectbrief">A framework for Terraria mods</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Packages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('md__home_travis_build_Jofairden_EvenMoreModifiers_docs_advancedcontentcreation.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Advanced content creation </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><hr/>
<p> In the following section we will go over advanced content creation, which includes an explanation of the more complex systems that are in place that make this possible.</p>
<h2>Automated event-based delegation</h2>
<hr/>
<p> This mod features what I call 'automated event-based delegation'. The purpose of this system is simple: it allows you to run <a class="el" href="class_mod_player.html">ModPlayer</a> code, through a Modifier. What does this mean? Just imagine that you need to run <a class="el" href="class_mod_player.html">ModPlayer</a> code for some Modifier, this system makes that possible <b>in an easy-to-use yet efficient manner</b>.</p>
<p>To use this, you do not need to understand how the system works internally: you just need to know how to call the necessary features to have it work. This system is used with ModifierEffects. This is a class not yet covered, so we will do so now.</p>
<h2>ModifierEffect &amp; delegation</h2>
<hr/>
<p> ModifierEffects live on the player, specifically a <a class="el" href="class_mod_player.html">ModPlayer</a>, part of EMM called the '<a href="https://github.com/Jofairden/EvenMoreModifiers/blob/rework/ModifierPlayer.cs">ModifierPlayer</a>'. Do not make these more complicated as they are: they give you access to virtually all <a class="el" href="class_mod_player.html">ModPlayer</a> hooks similarly to how Modifier exposes most <a class="el" href="class_global_item.html">GlobalItem</a> hooks to you. Instead, it does it in a different way. It does not inherit from <a class="el" href="class_mod_player.html">ModPlayer</a>, it is it's own class instead. This is where the event-based delegation comes into play, as it allows those hooks to actually be 'attached' to an existing <a class="el" href="class_mod_player.html">ModPlayer</a> hook. Here is what that looks like:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;public class CursedEffect : ModifierEffect</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;{</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;    public int CurseCount;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;    public override void ResetEffects(ModifierPlayer player)</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;    {</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;        CurseCount = 0;</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;    }</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;    [AutoDelegation(&quot;OnUpdateBadLifeRegen&quot;)]</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;    private void Curse(ModifierPlayer player)</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;    {</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;        if (CurseCount &gt; 0 &amp;&amp; !player.player.buffImmune[BuffID.Cursed])</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;        {</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;            if (player.player.lifeRegen &gt; 0)</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;            {</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;                player.player.lifeRegen = 0;</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;            }</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;            player.player.lifeRegen -= 2 * CurseCount;</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;            player.player.lifeRegenTime = 0;</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;        }</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;    }</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;}</div></div><!-- fragment --><p>The above example showcases a 'CursedEffect', that inherits from ModifierEffect. Our Curse method is being delegated to the <code>ModPlayer.OnUpdateBadLifeRegen</code>, notice how the AutoDelegation attribute makes that possible. All you need to make sure is that your method signature matches the one of the hook you want to attach to, where the first parameter is <em>always</em> of type ModifierPlayer. Even if the hook normally has no parameters.</p>
<p>You are now correct if you say that the Curse method is being ran from within the OnUpdateBadLifeRegen hook.</p>
<p>The effect is 'attached' to a Modifier in the following way:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;[UsesEffect(typeof(CursedEffect))]</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;public class CursedDamage : Modifier</div></div><!-- fragment --><p>Notice the UsesEffect attribute, in which you specify which effect should become active when an item has this modifier. Note that you can specify multiple effects, if you want:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;[UsesEffect(typeof(EffectOne), typeof(EffectTwo), typeof(EffectThree))]</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;public class MyModifier : Modifier</div></div><!-- fragment --> </div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.11 </li>
  </ul>
</div>
</body>
</html>
